---

title: Title

keywords: fastai
sidebar: home_sidebar



---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 12-frontier_and_remote.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Although both the FAR dataset and the ZCTA-to-whatever relationship files both come from Census,</span>
<span class="c1"># the zip code areas presented by FAR are from ESRI and are not entirely compatible with the ZCTA areas.</span>
<span class="c1"># ESRI business location data come from InfoGroup. It isn&#39;t clear where the zip code data that FAR take</span>
<span class="c1"># from ESRI are from, but they almost certainly are postal zip codes.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># From Wikipedia:</span>
<span class="c1"># ZCTAs are generalized area representations of the United States Postal Service (USPS) ZIP code service areas, </span>
<span class="c1"># but are not the same as ZIP codes. Individual USPS ZIP codes can cross state, place, county, census tract, </span>
<span class="c1"># census block group and census block boundaries, so the Census Bureau asserts that &quot;there is no correlation </span>
<span class="c1"># between ZIP codes and Census Bureau geography&quot;.[1] Moreover, the USPS frequently realigns, merges, or splits </span>
<span class="c1"># ZIP codes to meet changing needs. These changes are usually not reflected in the annual TIGER releases. </span>
<span class="c1"># Each ZCTA is constructed by aggregating the Census 2010 blocks whose addresses use a given ZIP code. In </span>
<span class="c1"># assembling census statistical units to create ZCTAs, the Census Bureau took the ZIP code used by the majority </span>
<span class="c1"># of addresses in each census unit at the time the data was compiled. As a result, some addresses end up with a </span>
<span class="c1"># ZCTA code that is different from their ZIP code. ZCTAs are not developed for ZIP codes that comprise only a </span>
<span class="c1"># small number of addresses.[2] Several ZCTAs represent ZIPs that no longer exist due to realignment by the USPS.</span>

<span class="c1"># There are approximately 42,000 ZIP Codes and 32,000 ZCTAs. The main reason that there is not one ZCTA for every </span>
<span class="c1"># ZIP Code is that PO Boxes are excluded in ZCTAs, since only populated areas are included in the Census data.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Summary: problems using zip code as an analytical unit.</span>

<span class="c1"># Postal zip codes change to suit the Postal Services needs and those changes are not immediately reflected</span>
<span class="c1"># in other data bases or in TIGER files.</span>

<span class="c1"># ZCTA (standardized zipcode-based tablulation areas) units are not the same as postal zip codes, as described</span>
<span class="c1"># above. </span>

<span class="c1"># We do not know the source of InfoGroup&#39;s zip code data. It is probably self-identified by the enterprise and</span>
<span class="c1"># therefore probably a postal zip code.</span>

<span class="c1"># ZCTA relationship files do not include any relationship between ZCTAs and postal zip codes. </span>

<span class="c1"># ESRI business location data comes from InfoGroup, which probably suggests that all their zip code data are</span>
<span class="c1"># postal zip codes. So the zip codes in the FAR data should be compatible with our InfoGroup data, although not </span>
<span class="c1"># aligned in time. The FAR data comes otherwise from the 2010 Census.</span>

<span class="c1"># The Census Geocoder can associate ZCTAs with lat/long, which would be just the thing. But it allows only 1,000 </span>
<span class="c1"># individual requests at a time. That would mean 14,700 separate batch jobs to apply ZCTA IDs to the 14.7 mn</span>
<span class="c1"># InfoGroup records for 2017. That doesn&#39;t come close to scaling.</span>

<span class="c1"># Python has a free zipcode database (installable with pip) called &#39;uszipcode&#39;. It refers only to</span>
<span class="c1"># postal zip codes. It does not take addresses as input but it does take lat/long, among many other parameters.</span>
<span class="c1"># https://uszipcode.readthedocs.io/index.html#id8</span>

<span class="c1"># Through the ZCTA relationship files we can associate ZCTAs with the OMB&#39;s </span>
<span class="c1"># metropolitan/micropolitan/nonmetropolitan spatial units and draw a basemap of ZCTAs, but we don&#39;t have</span>
<span class="c1"># analytical data at the moment at that geographical level.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">infile</span> <span class="o">=</span> <span class="s1">&#39;data/FARcodesZIPdata2010WithAKandHI.csv&#39;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;ZIP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ZIP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;ZIP&#39;, &#39;state&#39;, &#39;name&#39;, &#39;far1&#39;, &#39;far2&#39;, &#39;far3&#39;, &#39;far4&#39;, &#39;gridpop&#39;,
       &#39;sqmi&#39;, &#39;density&#39;, &#39;fr1pop&#39;, &#39;fr2pop&#39;, &#39;fr3pop&#39;, &#39;fr4pop&#39;, &#39;fr1pct&#39;,
       &#39;fr2pct&#39;, &#39;fr3pct&#39;, &#39;fr4pct&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>ZIP</th>
      <th>state</th>
      <th>name</th>
      <th>far1</th>
      <th>far2</th>
      <th>far3</th>
      <th>far4</th>
      <th>gridpop</th>
      <th>sqmi</th>
      <th>density</th>
      <th>fr1pop</th>
      <th>fr2pop</th>
      <th>fr3pop</th>
      <th>fr4pop</th>
      <th>fr1pct</th>
      <th>fr2pct</th>
      <th>fr3pct</th>
      <th>fr4pct</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>00002</td>
      <td>AK</td>
      <td>Yukon Flats Nat Wildlife</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>607</td>
      <td>95,707</td>
      <td>0.0</td>
      <td>606.4550106</td>
      <td>606.4550106</td>
      <td>606.4550106</td>
      <td>606.4550106</td>
      <td>99.96791067</td>
      <td>99.96791067</td>
      <td>99.96791067</td>
      <td>99.96791067</td>
    </tr>
    <tr>
      <td>1</td>
      <td>00007</td>
      <td>AK</td>
      <td>Southerly North Slope Bo</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>82</td>
      <td>65,388</td>
      <td>0.0</td>
      <td>81.6690849</td>
      <td>81.6690849</td>
      <td>81.6690849</td>
      <td>81.6690849</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
    <tr>
      <td>2</td>
      <td>99723</td>
      <td>AK</td>
      <td>Barrow</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>4,714</td>
      <td>20,301</td>
      <td>0.2</td>
      <td>4713.558186</td>
      <td>4713.558186</td>
      <td>4713.558186</td>
      <td>682.6115643</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>14.48187414</td>
    </tr>
    <tr>
      <td>3</td>
      <td>99559</td>
      <td>AK</td>
      <td>Bethel</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>11,984</td>
      <td>18,097</td>
      <td>0.7</td>
      <td>11983.63138</td>
      <td>11983.63138</td>
      <td>11983.63138</td>
      <td>6710.332216</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>55.99581632</td>
    </tr>
    <tr>
      <td>4</td>
      <td>99573</td>
      <td>AK</td>
      <td>Copper Center</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1,896</td>
      <td>17,741</td>
      <td>0.1</td>
      <td>1896.342902</td>
      <td>1896.342902</td>
      <td>1896.342902</td>
      <td>1896.342902</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
      <td>100</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
print('***',str(len(df)),'***')
f1 = df[df['far1']=='1']
print(len(f1))
f2 = df[df['far2']=='1']
print(len(f2))
f3 = df[df['far3']=='1']
print(len(f3))
f4 = df[df['far4']=='1']
print(len(f4))
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Create a &#39;FAR Level&#39; variable: </span>
<span class="c1"># 0 if all far* variables are zero.</span>
<span class="c1"># 1 if far1==1 and all others 0.</span>
<span class="c1"># 2 if far2==1 and far3==0 and far4==0</span>
<span class="c1"># 3 if far3==1 and far4==0</span>
<span class="c1"># 4 if far4==1</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_zip</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;ZIP&#39;</span><span class="p">,</span><span class="s1">&#39;far1&#39;</span><span class="p">,</span><span class="s1">&#39;far2&#39;</span><span class="p">,</span><span class="s1">&#39;far3&#39;</span><span class="p">,</span><span class="s1">&#39;far4&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_zip</span><span class="p">[[</span><span class="s1">&#39;far1&#39;</span><span class="p">,</span><span class="s1">&#39;far2&#39;</span><span class="p">,</span><span class="s1">&#39;far3&#39;</span><span class="p">,</span><span class="s1">&#39;far4&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df_zip</span><span class="p">[[</span><span class="s1">&#39;far1&#39;</span><span class="p">,</span><span class="s1">&#39;far2&#39;</span><span class="p">,</span><span class="s1">&#39;far3&#39;</span><span class="p">,</span><span class="s1">&#39;far4&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">farlevel</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">sum</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far1&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far2&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far3&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far4&#39;</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;far1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far2&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far3&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far4&#39;</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;far2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">sum</span><span class="p">([</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far3&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;far4&#39;</span><span class="p">]])</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">2</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;far3&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;far4&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">3</span>
    <span class="k">elif</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;far4&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">4</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_zip</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_zip</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">farlevel</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_zip</span><span class="p">))</span>
<span class="n">df_zip</span> <span class="o">=</span> <span class="n">df_zip</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">df_zip</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>30337
30319
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_zip</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0    24999
4     2599
1     1167
2      967
3      587
Name: FAR Level, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
consistent_0 = df[(df['far1']=='0') & (df['far2']=='0') & (df['far3']=='0') & (df['far4']=='0')]consistent_1 = df[(df['far1']=='1') & (df['far2']=='1') & (df['far3']=='1') & (df['far4']=='1')]print(len(consistent_0))
print(len(consistent_1))consistent = pd.concat([consistent_0,consistent_1],ignore_index=True)len(consistent)merge_temp = df.merge(consistent,how='left',on='ZIP',indicator=True)merge_temp['_merge'].value_counts()inconsistent = merge_temp[merge_temp['_merge']=='left_only'].drop(['state_y','name_y','far1_y', 'far2_y', 'far3_y', 
        'far4_y', 'gridpop_y', 'sqmi_y', 'density_y', 'fr1pop_y', 'fr2pop_y', 'fr3pop_y', 'fr4pop_y', 'fr1pct_y',
        'fr2pct_y', 'fr3pct_y', 'fr4pct_y', '_merge'], axis=1)inconsistent.rename(index=str,columns={'state_x':'state','name_x':'name','far1_x':'far1','far2_x':'far2',
                                      'far3_x':'far3','far4_x':'far4','gridpop_x':'gridpop','sqmi_x':'sqmi',
                                      'density_x':'density','fr1pop_x':'fr1pop','fr2pop_x':'fr2pop',
                                      'fr3pop_x':'fr3pop','fr4pop_x':'fr4pop','fr1pct_x':'fr1pct',
                                      'fr2pct_x':'fr2pct','fr3pct_x':'fr3pct','fr4pct_x':'fr4pct'},inplace=True)print(consistent.columns)
print(inconsistent.columns)# Created a dataframe of inconsistent far codes to try to figure out what the meaning of them is. 
print(inconsistent.head())
print(inconsistent.tail())# ========================================
# Testing python's 'uszipcode' database.# uszipcode has two backend database, SimpleZipcode and Zipcode. Zipcode has more info, but the database file 
# is 450MB (takes more time to download). SimpleZipcode doesnâ€™t has all data points listed above, but the 
# database file is smaller (9MB). By default uszipcode uses SimpleZipcode. You can use this code to choose to 
# use the rich info Zipcode:

#>>> from uszipcode import SearchEngine
#>>> search = SearchEngine(simple_zipcode=False)

from uszipcode import SearchEngine
search = SearchEngine(simple_zipcode=True)result = search.by_zipcode('53589')type(result)d = result.to_dict()dsearch.query(lat=d['lat'],lng=d['lng'],radius=1)
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">infile</span> <span class="o">=</span> <span class="s1">&#39;data/df_2017_OMB_Census_HRSA.csv&#39;</span>
<span class="n">df_ig</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">infile</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">df_ig</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>14733437</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_ig</span><span class="p">[</span><span class="s1">&#39;ZipCode&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_ig</span><span class="p">[</span><span class="s1">&#39;ZipCode&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">5</span> <span class="o">==</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">x</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="c1"># Add FAR codes to each InfoGroup record by matching on zip codes</span>
<span class="n">df_out</span> <span class="o">=</span> <span class="n">df_ig</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df_zip</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;ZipCode&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;ZIP&#39;</span><span class="p">,</span><span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 1min 39s, sys: 21.1 s, total: 2min
Wall time: 1min 34s
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_out</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>both          13265723
left_only      1467714
right_only           0
Name: _merge, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_out</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;ZIP&#39;</span><span class="p">,</span><span class="s1">&#39;_merge&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Select records only for 48 continental states for reporting. (FAR codes apply only to them.)</span>
<span class="n">df_select</span> <span class="o">=</span> <span class="n">df_out</span><span class="p">[(</span><span class="n">df_out</span><span class="p">[</span><span class="s1">&#39;Continental&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;1&#39;</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df_out</span><span class="p">[</span><span class="s1">&#39;State FIPS&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;11&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>14571195</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;***&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">f</span><span class="p">),</span><span class="s1">&#39;***&#39;</span><span class="p">)</span>

<span class="n">f1</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f1</span><span class="o">/</span><span class="n">f</span><span class="p">)</span>

<span class="n">f2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f2</span><span class="o">/</span><span class="n">f</span><span class="p">)</span>

<span class="n">f3</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f3</span><span class="o">/</span><span class="n">f</span><span class="p">)</span>

<span class="n">f4</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">4</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="n">f4</span><span class="o">/</span><span class="n">f</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>*** 14571195 ***
0.01518399829252165
0.011140541321422162
0.007552091643821938
0.008008128365587036
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fmiss</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fmiss</span><span class="o">/</span><span class="n">f</span><span class="p">))</span>

<span class="n">fnum</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">fnum</span><span class="o">/</span><span class="n">f</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;Stats only for in-scope (48 states) and non-missing.&#39;</span><span class="p">)</span>
<span class="n">f0</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Not Far and remote:&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">f0</span><span class="o">/</span><span class="n">fnum</span><span class="p">))</span>

<span class="n">ft</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df_select</span><span class="p">[</span><span class="n">df_select</span><span class="p">[</span><span class="s1">&#39;FAR Level&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Far and remote:&#39;</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">ft</span><span class="o">/</span><span class="n">fnum</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0.10019150797172093
0.8998084920282791

Stats only for in-scope (48 states) and non-missing.
Not Far and remote: 0.9534514732919008
Far and remote: 0.04654852670809917
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">outfile</span> <span class="o">=</span> <span class="s1">&#39;data/df_2017_OMB_Census_HRSA_FAR.csv&#39;</span>
<span class="n">df_out</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">outfile</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

