---

title: Title

keywords: fastai
sidebar: home_sidebar



---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 08-rural_by_tract_centroid.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Explore rural census tracts in metro counties (CBSAs) and urban areas (UAs).</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Point</span><span class="p">,</span> <span class="n">Polygon</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">max_rows</span> <span class="o">=</span> <span class="mi">999</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># All tracts</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;/InfoGroup/rural/map_files/tracts/tl_2017_USA_tract.shp&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gdf</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;STATEFP&#39;, &#39;COUNTYFP&#39;, &#39;TRACTCE&#39;, &#39;GEOID&#39;, &#39;NAME&#39;, &#39;NAMELSAD&#39;, &#39;MTFCC&#39;,
       &#39;FUNCSTAT&#39;, &#39;ALAND&#39;, &#39;AWATER&#39;, &#39;INTPTLAT&#39;, &#39;INTPTLON&#39;, &#39;geometry&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Compute the centroid of the polygon</span>
<span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdf</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">centroid</span><span class="p">))</span> <span class="c1"># shapely methods</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">gdf</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>STATEFP</th>
      <th>COUNTYFP</th>
      <th>TRACTCE</th>
      <th>GEOID</th>
      <th>NAME</th>
      <th>NAMELSAD</th>
      <th>MTFCC</th>
      <th>FUNCSTAT</th>
      <th>ALAND</th>
      <th>AWATER</th>
      <th>INTPTLAT</th>
      <th>INTPTLON</th>
      <th>geometry</th>
      <th>centroid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>46</td>
      <td>075</td>
      <td>091600</td>
      <td>46075091600</td>
      <td>916</td>
      <td>Census Tract 916</td>
      <td>G5020</td>
      <td>S</td>
      <td>2511453379</td>
      <td>3147180</td>
      <td>+43.9519896</td>
      <td>-100.6861386</td>
      <td>POLYGON ((-101.064626 43.96611799999999, -101....</td>
      <td>POINT (-100.6897219989547 43.96060830334499)</td>
    </tr>
    <tr>
      <td>1</td>
      <td>46</td>
      <td>129</td>
      <td>965200</td>
      <td>46129965200</td>
      <td>9652</td>
      <td>Census Tract 9652</td>
      <td>G5020</td>
      <td>S</td>
      <td>50637139</td>
      <td>17634531</td>
      <td>+45.5481591</td>
      <td>-100.4222642</td>
      <td>POLYGON ((-100.486583 45.537934, -100.486571 4...</td>
      <td>POINT (-100.4204913301959 45.55065746393002)</td>
    </tr>
    <tr>
      <td>2</td>
      <td>46</td>
      <td>129</td>
      <td>965100</td>
      <td>46129965100</td>
      <td>9651</td>
      <td>Census Tract 9651</td>
      <td>G5020</td>
      <td>S</td>
      <td>1784710819</td>
      <td>75580712</td>
      <td>+45.4278339</td>
      <td>-100.0075629</td>
      <td>POLYGON ((-100.387018 45.53725, -100.386639 45...</td>
      <td>POINT (-100.0172511111368 45.42551049826866)</td>
    </tr>
    <tr>
      <td>3</td>
      <td>46</td>
      <td>091</td>
      <td>950800</td>
      <td>46091950800</td>
      <td>9508</td>
      <td>Census Tract 9508</td>
      <td>G5020</td>
      <td>S</td>
      <td>2170630077</td>
      <td>124680563</td>
      <td>+45.7370443</td>
      <td>-097.5808695</td>
      <td>POLYGON ((-97.979636 45.603137, -97.979635 45....</td>
      <td>POINT (-97.5985004429327 45.75867076685663)</td>
    </tr>
    <tr>
      <td>4</td>
      <td>46</td>
      <td>109</td>
      <td>940700</td>
      <td>46109940700</td>
      <td>9407</td>
      <td>Census Tract 9407</td>
      <td>G5020</td>
      <td>S</td>
      <td>1293755958</td>
      <td>38170551</td>
      <td>+45.8123364</td>
      <td>-096.9277941</td>
      <td>POLYGON ((-97.228313 45.934417, -97.2283109999...</td>
      <td>POINT (-96.92711283028811 45.81412865434089)</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># File that contains polygon geometry of UAs for 2017</span>
<span class="c1">#ua_gdf = gpd.read_file(&#39;map_files/tl_2017_us_uac10.shp&#39;)</span>
<span class="c1"># File that contains polygon geometry of UAs for 2010</span>
<span class="n">ua_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;map_files/tl_2010_us_uac10.shp&#39;</span><span class="p">)</span>
<span class="n">ua_gdf</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;UACE10&#39;, &#39;GEOID10&#39;, &#39;NAME10&#39;, &#39;NAMELSAD10&#39;, &#39;LSAD10&#39;, &#39;MTFCC10&#39;,
       &#39;UATYP10&#39;, &#39;FUNCSTAT10&#39;, &#39;ALAND10&#39;, &#39;AWATER10&#39;, &#39;INTPTLAT10&#39;,
       &#39;INTPTLON10&#39;, &#39;geometry&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ua_gdf</span><span class="p">[</span><span class="s1">&#39;UATYP10&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>C    3095
U     497
Name: UATYP10, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gdf</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ua_gdf</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>73056
3592
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="See-the-comments-below.">See the comments below.<a class="anchor-link" href="#See-the-comments-below."> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">xgdf</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">xua_gdf</span> <span class="o">=</span> <span class="n">ua_gdf</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xgdf</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xua_gdf</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>7306
359
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Assign a UA code </span>
<span class="n">relationship</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">k</span> <span class="ow">in</span> <span class="n">xgdf</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="n">xua_gdf</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">k</span><span class="p">[</span><span class="s1">&#39;centroid&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">within</span><span class="p">(</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">]):</span>
            <span class="n">relationship</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">k</span><span class="p">[</span><span class="s1">&#39;GEOID&#39;</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;GEOID10&#39;</span><span class="p">],</span><span class="n">l</span><span class="p">[</span><span class="s1">&#39;UATYP10&#39;</span><span class="p">]])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rel_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">relationship</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tract GEOID&#39;</span><span class="p">,</span><span class="s1">&#39;UA GEOID10&#39;</span><span class="p">,</span><span class="s1">&#39;UATYP10&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rel_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">#rel_df.to_csv(&#39;/InfoGroup/rural/points-in-polygons/data/rel_df.csv&#39;,index=None)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The above creation of the relationship list of lists and rel_df.csv file worked on a sample from</span>
<span class="c1"># the input files.</span>
<span class="c1"># The same logic applied to the full UA and tract files was executed in the tracts.py program in</span>
<span class="c1"># /InfoGroup/rural/points-in-polygons/. It took 14.67 clock hours to complete. The cells below </span>
<span class="c1"># read the rel_df.csv</span>
<span class="c1"># file created by that program execution. There are 50,198 pairs of tract and UA codes. These </span>
<span class="c1"># are cases in which the</span>
<span class="c1"># centroid of a tract was found to be contained within the boundaries of a census urban area. </span>
<span class="c1"># Matching back to the</span>
<span class="c1"># full list of census tracts, we can identify those as rural whose centroids do not fall within </span>
<span class="c1"># any UA.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rel_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;/InfoGroup/rural/points-in-polygons/data/rel_df.csv&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">rel_df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>50198</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1">## All tracts</span>
<span class="n">gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s1">&#39;/InfoGroup/rural/map_files/tracts/tl_2017_USA_tract.shp&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># Merge the two dataframes. The resulting dataframe will have the rural tracts flagged by a missing value</span>
<span class="c1"># for &#39;UA Code&#39;.</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">gdf</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">rel_df</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span><span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;GEOID&#39;</span><span class="p">,</span><span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;tract_GEOID&#39;</span><span class="p">,</span><span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>both          50198
left_only     22858
right_only        0
Name: _merge, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rur</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;left_only&#39;</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rur</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rur</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>22858
  STATEFP COUNTYFP TRACTCE        GEOID  NAME           NAMELSAD  MTFCC  \
0      46      075  091600  46075091600   916   Census Tract 916  G5020   
1      46      129  965200  46129965200  9652  Census Tract 9652  G5020   
2      46      129  965100  46129965100  9651  Census Tract 9651  G5020   
3      46      091  950800  46091950800  9508  Census Tract 9508  G5020   
4      46      109  940700  46109940700  9407  Census Tract 9407  G5020   

  FUNCSTAT       ALAND     AWATER     INTPTLAT      INTPTLON  \
0        S  2511453379    3147180  +43.9519896  -100.6861386   
1        S    50637139   17634531  +45.5481591  -100.4222642   
2        S  1784710819   75580712  +45.4278339  -100.0075629   
3        S  2170630077  124680563  +45.7370443  -097.5808695   
4        S  1293755958   38170551  +45.8123364  -096.9277941   

                                            geometry tract_GEOID UA_GEOID10  \
0  POLYGON ((-101.064626 43.96611799999999, -101....         NaN        NaN   
1  POLYGON ((-100.486583 45.537934, -100.486571 4...         NaN        NaN   
2  POLYGON ((-100.387018 45.53725, -100.386639 45...         NaN        NaN   
3  POLYGON ((-97.979636 45.603137, -97.979635 45....         NaN        NaN   
4  POLYGON ((-97.228313 45.934417, -97.2283109999...         NaN        NaN   

      _merge  
0  left_only  
1  left_only  
2  left_only  
3  left_only  
4  left_only  
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;rural_spatial_tract&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="s1">&#39;UA_GEOID10&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s1">&#39;nan&#39;</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;rural_spatial_tract&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0    50198
1    22858
Name: rural_spatial_tract, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">columns</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Index([&#39;STATEFP&#39;, &#39;COUNTYFP&#39;, &#39;TRACTCE&#39;, &#39;GEOID&#39;, &#39;NAME&#39;, &#39;NAMELSAD&#39;, &#39;MTFCC&#39;,
       &#39;FUNCSTAT&#39;, &#39;ALAND&#39;, &#39;AWATER&#39;, &#39;INTPTLAT&#39;, &#39;INTPTLON&#39;, &#39;geometry&#39;,
       &#39;tract_GEOID&#39;, &#39;UA_GEOID10&#39;, &#39;_merge&#39;, &#39;rural_spatial_tract&#39;],
      dtype=&#39;object&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;tract_GEOID&#39;</span><span class="p">,</span><span class="s1">&#39;_merge&#39;</span><span class="p">],</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span> <span class="p">(</span><span class="n">merged</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>73056</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rural_only</span> <span class="o">=</span> <span class="n">merged</span><span class="p">[</span><span class="n">merged</span><span class="p">[</span><span class="s1">&#39;rural_spatial_tract&#39;</span><span class="p">]</span><span class="o">==</span><span class="mi">1</span><span class="p">]</span>
<span class="n">rural_only</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;/InfoGroup/rural/points-in-polygons/data/rural_spatial_tracts.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">merged</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;/InfoGroup/rural/points-in-polygons/data/all_tracts.csv&#39;</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">len</span><span class="p">(</span><span class="n">rural_only</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.312883267630311</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 31.3% of census tracts are rural by this definition; i.e., that the tract&#39;s spatial centroid does not fall</span>
<span class="c1"># anywhere within the boundaries of a census urban area.</span>
<span class="c1">#</span>
<span class="c1"># Do the FORHP rural census tracts (defined entirely differently) overlap considerably with this complete</span>
<span class="c1"># list of rural census tracts?</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">rural_tracts</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;data/rural_census_tracts.lis&quot;</span><span class="p">)]</span>
<span class="nb">len</span><span class="p">(</span><span class="n">rural_tracts</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2302</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">forhp_tracts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rural_tracts</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;GEOID&#39;</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">overlap_merge</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">forhp_tracts</span><span class="p">,</span><span class="n">on</span><span class="o">=</span><span class="s1">&#39;GEOID&#39;</span><span class="p">,</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">,</span><span class="n">indicator</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">overlap_merge</span><span class="p">[</span><span class="s1">&#39;_merge&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>left_only     70849
both           2207
right_only       95
Name: _merge, dtype: int64</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># So 95 of the FORHP 2,302 rural census tracts do not qualify as rural by the centroid-in-UA criterion.</span>
<span class="mi">95</span><span class="o">/</span><span class="mi">2302</span>
<span class="c1"># That&#39;s 4.1%.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.04126846220677671</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The UA and tract files used in this procedure are from 2017. The FORHP calculations apply to</span>
<span class="c1"># 2010, with revisions to the second-tier codes in 2019.</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

